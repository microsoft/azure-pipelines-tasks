steps:
- task: NuGetToolInstaller@0
  inputs:
    versionSpec: 6.0.0
  displayName: Install nuget

- powershell: |
    cd $(Build.SourcesDirectory)/ci/courtesy-push
    npm ci
  displayName: npm ci

- task: DownloadBuildArtifacts@0
  inputs:
    artifactName: IndividualNugetPackages
    downloadPath: $(Build.SourcesDirectory)/IndividualNugetPackagesDownloaded
  displayName: Download Artifact

- powershell: $(Build.SourcesDirectory)/ci/set-sprint-variables.ps1
  displayName: Set currentSprint variables

- powershell: |
    $currentDate = Get-Date -Format "yyyyMMdd-HHmm"
    Write-Host "##vso[task.setVariable variable=currentDate]$currentDate"
  displayName: Set currentDate variable

- template: /ci/generate-branch-name.yml@self
- template: /ci/get-AzDo-pat.yml@self

- script: node $(Build.SourcesDirectory)/ci/courtesy-push/courtesy-push.js $(Build.SourcesDirectory)/IndividualNugetPackagesDownloaded/IndividualNugetPackages/unified_deps.xml
  displayName: Update unified deps and create branch
  env:
    TOKEN: $(AzDo_PAT)
    BRANCH_NAME: $(branchName)
    DRYRUN: $(isDryRun)
    USERNAME: $(username)
    
- powershell: $(Build.SourcesDirectory)/ci/courtesy-push/send-notification.ps1
  displayName: Send MS Teams notification
  condition: or(eq(variables['build.reason'], 'Schedule'), eq(variables['build.reason'], 'Manual'))
  env:
    TEAMS_WEBHOOK: $(MSTeamsUri)
