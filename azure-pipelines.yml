trigger:
- master


parameters:
- name: build_single_task
  displayName: Build Single Task
  type: boolean
  default: true
- name: task_names
  displayName: Task Name
  type: string
  default: MavenV3, UseNodeV1
- name: push_to_feed
  displayName: Push to Feed
  type: boolean
  default: false

jobs:

- ${{ if parameters.build_single_task }}:
  - ${{ each var in split(parameters.task_names, ', ') }}:
    - job: build_single_task_${{ var.value }}
      displayName: Build Single Task
      pool:
        vmImage: windows-2022
      steps:
      - template: ci/build-single-steps.yml
        parameters:
          task: ${{ var.value }}
          push: ${{ parameters.push_to_feed }}
          patchVersion: true
          version: '0.9999.9999'
    - job: upload_test_task
      displayName: upload task to test_${{ var.value }}
      pool:
        vmImage: windows-2022
      steps:
      - template: ci/publish-and-test.yml

    - ${{ if not(parameters.build_single_task) }}:
      - job: build_all_windows
        displayName: Build all tasks (Windows)
      #  condition: eq(variables.os, 'Windows_NT')
        timeoutInMinutes: 180
        pool:
          vmImage: windows-2022
        steps:
        - template: ci/build-all-steps.yml
          parameters:
            os: Windows_NT


      
# - job: validate_uploaded_task
#    displayName: Validate uploaded task
#    pool:
#      vmImage: windows-2022
#    steps:
#      template: ci/validate-task.yml

# - job: remove_task_from_organization
#    displayName: remove
#    pool:
#   vmImage: windows-2022
# steps:
#   template: ci/remove-task.yml

