trigger:
  - none
pr:
  branches:
    exclude:
      - master


jobs:
- job: get_tasks
  condition: eq(variables['Build.Reason'], 'PullRequest')
  steps:
  - script: git pull
    continueOnError: true
    displayName: 'git pull'

  - script: git checkout $(System.PullRequest.SourceBranch)
    displayName: 'git checkout $(System.PullRequest.SourceBranch)'

  - script: |
      echo $(Build.Reason)
      echo $(System.PullRequest.SourceBranch)

  - script: |
      export tasks=$(node ./ci/testing/getTaskNames.js $(git diff --name-only origin/master))
      ##vso[task.setvariable variable=tasks;isoutput=true]$tasks
      echo "Tasks changed: $tasks"
      echo "##vso[task.setvariable variable=myVar;]foo"
    displayName: 'GetTasks'

  - script: |
      echo "----------------------"
      echo $(GetTasks.tasks)
      echo "----------------------"
      echo "Tasks: $tasks"
      echo "Tasks: $(tasks)"
      ret=$(node ./ci/testing/useTaskNames.js $(tasks))
    displayName: 'Use tasks names'
