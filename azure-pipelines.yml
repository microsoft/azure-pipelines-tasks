#trigger:
#  - none
#pr:
#  branches:
#    include:
#      - '*'
#    exclude:
#      - master


jobs:
- job: get_tasks
  condition: and(eq(variables['build.reason'], 'PullRequest'), eq(variables['system.pullRequest.sourceRepositoryUri'], 'https://github.com/PavloAndriiesh/azure-pipelines-tasks'))
  steps:
  - script: npm install @octokit/core
    displayName: 'npm install @octokit/core'

  - script: |
      export tasks=$(node ./ci/testing/getTaskNames.js $(PAT_Github))
      echo "##vso[task.setvariable variable=tasks;isoutput=true]$tasks"
      echo "$tasks"
    displayName: 'Get tasks names'

  - script: |
      echo "$tasks"
    displayName: 'Output tasks'

  - script: |
      export taskIds=$(node ./ci/testing/getTaskIds.js $(git ls-files))
      echo "##vso[task.setvariable variable=tasks]$taskIds"
      echo "$taskIds"
    displayName: 'Set taskIds'

  - script: |
      echo "$(taskIds)"
    displayName: 'Output taskIds'


  - script: |
      echo "##vso[task.setvariable variable=foo;]bar"
    displayName: 'Set variable foo'

  - script: |
      echo "$(foo)"
    displayName: 'Output variable foo'

