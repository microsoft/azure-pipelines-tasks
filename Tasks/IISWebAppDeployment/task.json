{
    "id": "89A3A82D-4B3E-4A09-8D40-A793849DC94F",
    "name": "IISWebAppDeployment",
    "friendlyName": "IIS Web Application Deployment",
    "description": "Deploy Web Application using Web Deploy (MSDeploy) to IIS Website",
    "helpMarkDown": "[More Information](http://aka.ms/iiswebappdeployreadme)",
    "category": "Deploy",
    "visibility": [
        "Preview",
        "Build",
        "Release"
    ],
    "author": "Microsoft Corporation",
    "version": {
        "Major": 1,
        "Minor": 0,
        "Patch": 0
    },
    "demands": [
    ],
    "minimumAgentVersion": "1.88.0",
    "groups": [
        {
            "name": "website",
            "displayName": "Create or Update Website",
            "isExpanded": true
        },
        {
            "name": "applicationPool",
            "displayName": "Create or Update Application Pool",
            "isExpanded": true
        },
        {
            "name": "advanced",
            "displayName": "Advanced",
            "isExpanded": false
        }
    ],
    "inputs": [
        {
            "name": "EnvironmentName",
            "type": "pickList",
            "label": "Machine Group",
            "defaultValue": "",
            "required": true,
            "helpMarkDown": "Name of the target Machine Group for deploying the IIS Web Application."
        },
        {
            "name": "ResourceFilteringMethod",
            "type": "radio",
            "label": "Select Machines By",
            "required": false,
            "defaultValue": "machineNames",
            "options": {
                "machineNames": "Machine Names",
                "tags": "Tags"
            },
            "helpMarkDown": "Optionally select a subset of machines either by providing machine names or tags."
        },
        {
            "name": "MachineFilter",
            "type": "string",
            "label": "Filter Criteria",
            "required": false,
            "defaultValue": "",
            "helpMarkDown": "Provide a list of machines like dbserver.fabrikam.com, dbserver_int.fabrikam.com, 192.168.12.34 or tags like Role:DB;OS:Win8.1. Returns machines with either of the tags. For Azure Resource Group provide the VM Host Name for the machine name. The default is all machines in the machine group."
        },
        {
            "name": "WebDeployPackage",
            "type": "string",
            "label": "Web Deploy Package",
            "required": true,
            "defaultValue": "",
            "helpMarkDown": "Location of the Web Deploy (MSDeploy) zip file on the target machines or a UNC path like \\\\BudgetIT\\Web\\Deploy\\WebDeployPackage.zip."
        },
        {
            "name": "WebDeployParamFile",
            "type": "string",
            "label": "Web Deploy Parameters File",
            "required": false,
            "defaultValue": "",
            "helpMarkDown": "Location of the Parameters file on the target machines or a UNC path. Parameters file is used to override Web application configuration settings like IIS Web application name or database connection strings."
        },
        {
            "name": "OverRideParams",
            "type": "string",
            "label": "Override Parameters",
            "required": false,
            "defaultValue": "",
            "helpMarkDown": "Parameters specified here will override the parameters in the MSDeploy zip file and the Parameters file. For example -  name=\"IIS Web Application Name\", value=\"Fabrikam\"." 
        },
        {
            "name": "WebSiteName",
            "type": "string",
            "label": "Website Name",
            "required": false,
            "groupName": "website",
            "defaultValue": "",
            "helpMarkDown": "Name of the website to create in the IIS server. If the website already exists then it will be updated with the settings specified here."
        },
        {
            "name": "WebSitePhysicalPath",
            "type": "string",
            "label": "Physical Path",
            "required": true,
            "groupName": "website",
            "defaultValue": "%SystemDrive%\\inetpub\\wwwroot",
            "helpMarkDown": "Physical path where the website content is stored. The content can reside on the local computer or on a remote directory or share, for example, C:\\Fabrikam or \\\\ContentShare\\Fabrikam."
        },
        {
            "name": "WebSitePhysicalPathAuth",
            "type": "pickList",
            "label": "Physical Path Authentication",
            "required": true,
            "groupName": "website",
            "defaultValue": "Application User(Pass-through)",
            "options": {
                "WebSiteUserPassThrough": "Application User(Pass-through)",
                "WebSiteWindowsAuth": "Windows Authentication"
            },
            "helpMarkDown": "Authentication mechanism for accessing the physical path of website."
        },
        {
            "name": "WebSiteAuthUserName",
            "type": "string",
            "label": "User Name",
            "required": true,
            "groupName": "website",
            "defaultValue": "",
            "visibleRule": "WebSitePhysicalPathAuth = WebSiteWindowsAuth",
            "helpMarkDown": "User name for accessing the website's physical path."
        },
        {
            "name": "WebSiteAuthUserPassword",
            "type": "string",
            "label": "Password",
            "required": true,
            "groupName": "website",
            "defaultValue": "",
            "visibleRule": "WebSitePhysicalPathAuth = WebSiteWindowsAuth",
            "helpMarkDown": "Password for accessing the website's physical path."
        },
        {
            "name": "AddBinding",
            "type": "boolean",
            "label": "Add Binding",
            "required": false,
            "groupName": "website",
            "defaultValue": "true",
            "helpMarkDown": "Select the option to add port binding for the website."
        },
        {
            "name": "Protocol",
            "type": "pickList",
            "label": "Protocol",
            "required": true,
            "groupName": "website",
            "defaultValue": "http",
            "options": {
                "https": "https",
                "http": "http"
            },
            "visibleRule": "AddBinding = true",
            "helpMarkDown": "Select HTTP for the website to have an HTTP binding, or select HTTPS for the website to have a Secure Sockets Layer (SSL) binding."
        },
        {
            "name": "IPAddress",
            "type": "string",
            "label": "IP Address",
            "required": true,
            "groupName": "website",
            "defaultValue": "All Unassigned",
            "visibleRule": "AddBinding = true",
            "helpMarkDown": "Type an IP address that users can use to access this website. If All Unassigned is selected, the site will respond to requests for all IP addresses on the port and optional host name that is specified for this site, unless another site on the server has a binding on the same port but with a specific IP address."
        },
        {
            "name": "Port",
            "type": "string",
            "label": "Port",
            "required": true,
            "groupName": "website",
            "defaultValue": "80",
            "visibleRule": "AddBinding = true",
            "helpMarkDown": "Type the port on which HTTP.sys must listen for requests made to this website."
        },
        {
            "name": "HostName",
            "type": "string",
            "label": "Host Name",
            "required": false,
            "groupName": "website",
            "defaultValue": "",
            "visibleRule": "AddBinding = true",
            "helpMarkDown": "Type a host (domain) name, to assign one or more host names, to one computer that uses a single IP address."
        },
        {
            "name": "ServerNameIndication",
            "type": "boolean",
            "label": "Server Name Indication Required",
            "required": false,
            "groupName": "website",
            "defaultValue": "false",
            "visibleRule": "Protocol = https",
            "helpMarkDown": "Determines whether the website requires Server Name Indication (SNI). SNI extends the SSL and TLS protocols to indicate what host name the client is attempting to connect to. It allows multiple secure websites with different certificates to use the same IP address."
        },
        {
            "name": "SSLCertThumbPrint",
            "type": "string",
            "label": "SSL Certificate Thumb Print",
            "required": true,
            "groupName": "website",
            "defaultValue": "",
            "visibleRule": "Protocol = https",
            "helpMarkDown": "Thumb-print of the Secure Socket Layer certificate that the website is going to use. The certificate should be installed on the machine."
        },
        {
            "name": "AppPoolName",
            "type": "string",
            "label": "Name",
            "defaultValue": "",
            "required": false,
            "groupName": "applicationPool",
            "helpMarkDown": "Name of the IIS application pool to create or update. Existing application pool will be updated with the settings specified here."
        },
        {
            "name": "DotNetVersion",
            "type": "pickList",
            "label": ".NET Version",
            "defaultValue": "v4.0",
            "required": true,
            "groupName": "applicationPool",
            "helpMarkDown": "Version of the .NET Framework that is loaded by this application pool. If the applications that you want to assign to this application pool do not contain managed code, select the No Managed Code option from the list.",
            "options": {
                "v4.0": "v4.0",
                "v2.0": "v2.0",
                "No Managed Code": "No Managed Code"
            }
        },
        {
            "name": "PipeLineMode",
            "type": "pickList",
            "label": "Managed Pipeline Mode",
            "defaultValue": "Integrated",
            "required": true,
            "groupName": "applicationPool",
            "helpMarkDown": "Managed pipeline mode specified how IIS processes requests for managed content. Use classic mode only when the applications in the application pool cannot run in Integrated mode.",
            "options": {
                "Integrated": "Integrated",
                "Classic": "Classic"
            }
        },
        {
            "name": "AppPoolIdentity",
            "type": "pickList",
            "label": "Identity",
            "defaultValue": "ApplicationPoolIdentity",
            "required": true,
            "groupName": "applicationPool",
            "helpMarkDown": "Configure the account under which an application pool's worker process runs. Select one of the predefined security accounts or configure a custom account.",
            "options": {
                "ApplicationPoolIdentity": "ApplicationPoolIdentity",
                "LocalService": "LocalService",
                "LocalSystem": "LocalSystem",
                "NetworkService": "NetworkService",
                "SpecificUser": "Custom Account"
            }
        },
        {
            "name": "AppPoolUsername",
            "type": "string",
            "label": "Username",
            "defaultValue": "",
            "required": true,
            "groupName": "applicationPool",
            "visibleRule": "AppPoolIdentity = SpecificUser"
        },
        {
            "name": "AppPoolPassword",
            "type": "string",
            "label": "Password",
            "defaultValue": "",
            "required": true,
            "groupName": "applicationPool",
            "visibleRule": "AppPoolIdentity = SpecificUser"
        },
        {
            "name": "AppCmdCommands",
            "type": "multiLine",
            "label": "Additional Appcmd.exe Commands",
            "required": false,
            "groupName": "advanced",
            "defaultValue": "",
            "helpMarkDown": "Additional appcmd.exe commands to set website or application pool properties. For more than one command use line separators, e.g., set config /section:applicationPools /[name='Fabrikam'].autoStart:false\n add site /name:fabrikam /bindings:http/*:85: fabrikam.com."
        },
        {
            "name": "DeployInParallel",
            "type": "boolean",
            "label": "Deploy in Parallel",
            "defaultValue": "true",
            "required": false,
            "groupName": "advanced",
            "helpMarkDown": "Setting it to true will deploy the Web application in-parallel on the target machines."
        }
    ],
    "sourceDefinitions": [ 
     { 
         "target": "EnvironmentName", 
         "endpoint": "/$(system.teamProject)/_apis/vslabs/environments", 
         "selector": "jsonpath:$.value[*].name", 
         "authKey": "tfs:DevTestLabs" 
     } 
    ],
    "instanceNameFormat": "Deploy IIS App: $(WebDeployPackage)",
    "execution": {
        "PowerShell": {
        "target": "$(currentDirectory)\\DeployIISWebApp.ps1",
        "argumentFormat": "",
        "workingDirectory": "$(currentDirectory)"
        }
    }
}
